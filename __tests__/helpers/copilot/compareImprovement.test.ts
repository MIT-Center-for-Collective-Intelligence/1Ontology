import { compareImprovement } from " @components/lib/utils/copilotHelpers";
import { INode } from " @components/types/INode";
import { convertLength } from "@mui/material/styles/cssUtils";
const nodeTitles: { [id: string]: INode } = {
  "New unclassifiedd": {
    id: "YC2Ui3sV6RCggOnUdRy3",
    root: "prg28paWo3J5oJZKpwqW",

    nodeType: "activity",
    propertyOf: {
      parts: [
        {
          collectionName: "main",
          nodes: [
            {
              id: "YC2Ui3sV6RCggOnUdRy3",
            },
          ],
        },
      ],
    },
    locked: false,
    title: "New unclassifiedd",
    textValue: {
      Objects:
        "prg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW\n\n\nprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW",
      evaluationDimension:
        "das;lfkds;glprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW",
      parts: "test test ok",
      actor: "oh please \n\ncan you imagine",
      specializations: "ok but",
      isPartOf: "",
    },
    deleted: false,
    numberOfGeneralizations: 1,
    unclassified: false,
    createdBy: "ouhrac",
    generalizations: [
      {
        collectionName: "main",
        nodes: [
          {
            id: "ntmokzoFkA3k1iP4mLwU",
          },
          {
            id: "prg28paWo3J5oJZKpwqW",
          },
        ],
      },
    ],

    specializations: [
      {
        nodes: [],
        collectionName: "main",
      },
    ],
    propertyType: {
      evaluationDimension: "evaluationDimension",
      TestProprety: "string-array",
      description: "string",
      context: "context",
      preConditions: "string-array",
      actor: "actor",
      Objects: "object",
      ok: "string-array",
      postConditions: "string-array",
    },
    properties: {
      ok: [],
      preConditions: [],
      postConditions: [],
      TestProprety: [],
      description: "rttrr tell me why would you ",
      evaluationDimension: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      parts: [
        {
          collectionName: "main",
          nodes: [
            {
              id: "YC2Ui3sV6RCggOnUdRy3",
            },
          ],
        },
      ],
      context: [
        {
          nodes: [
            {
              id: "MlUNhqiQfloPduiiKvyU",
            },
          ],
          collectionName: "main",
        },
      ],
      actor: [
        {
          collectionName: "main",
          nodes: [
            {
              id: "iyy1sBre1lXSqnKPJD8a",
            },
            {
              id: "51VEhBCzmjjIamDvfLoV",
            },
          ],
        },
      ],
      Objects: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      isPartOf: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
    },
    inheritance: {
      description: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      evaluationDimension: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      ok: {
        ref: "ntmokzoFkA3k1iP4mLwU",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      Objects: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
      context: {
        ref: "ntmokzoFkA3k1iP4mLwU",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      preConditions: {
        ref: "ntmokzoFkA3k1iP4mLwU",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      postConditions: {
        ref: "ntmokzoFkA3k1iP4mLwU",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      parts: {
        ref: "ntmokzoFkA3k1iP4mLwU",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      actor: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "ntmokzoFkA3k1iP4mLwU",
      },
      TestProprety: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
    },
  },
  Node6: {
    createdBy: "ouhrac",
    nodeType: "activity",
    root: "prg28paWo3J5oJZKpwqW",
    deleted: false,
    locked: false,
    textValue: {
      evaluationDimension: "",
      parts: "test test ok",
      actor: "oh please \n\ncan you imagine",
      isPartOf: "",
      postConditions: "\n\n\n\n\n\n\n\n",
      Objects:
        "prg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW\n\n\nprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW",
    },
    id: "y3vtdh7IFcuv843xCJGg",
    generalizations: [
      {
        collectionName: "main",
        nodes: [
          {
            id: "prg28paWo3J5oJZKpwqW",
          },
        ],
      },
    ],
    title: "Node6",
    unclassified: false,
    propertyOf: {},
    specializations: [
      {
        collectionName: "main",
        nodes: [
          {
            id: "u2lEBcBeBxbZV6yjOIO1",
          },
        ],
      },
    ],
    propertyType: {
      evaluationDimension: "evaluationDimension",
      ok: "string-array",
      Objects: "object",
      preConditions: "string-array",
      description: "string",
      context: "context",
      TestProprety: "string-array",
      actor: "actor",
      postConditions: "string-array",
    },
    inheritance: {
      Objects: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      actor: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
      description: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      parts: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      evaluationDimension: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      context: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      ok: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: null,
      },
      preConditions: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: null,
      },
      postConditions: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: null,
      },
      TestProprety: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: null,
      },
    },
    contributorsByProperty: {
      TestProprety: ["ouhrac"],
    },
    contributors: ["ouhrac"],
    properties: {
      ok: [],
      description:
        "A comprehensive procedure overseeing all aspects of aircraft arrivals at Airport X, from initial approach to gate arrival and preparation for departure. This includes coordination with air traffic control, ground handling services, and other relevant stakeholders, ensuring efficient and safe arrival procedures.",
      isPartOf: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      context: [
        {
          nodes: [
            {
              id: "MlUNhqiQfloPduiiKvyU",
            },
          ],
          collectionName: "main",
        },
      ],
      evaluationDimension: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      Objects: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      actor: [
        {
          collectionName: "main",
          nodes: [
            {
              id: "iyy1sBre1lXSqnKPJD8a",
            },
          ],
        },
      ],
      parts: [
        {
          collectionName: "main",
          nodes: [
            {
              id: "OSXrHQdfKmEZVUr0oR22",
            },
          ],
        },
      ],
      preConditions: [],
      postConditions: [],
      TestProprety: ["ok yh"],
    },
  },
  "Gate Arrival": {
    id: "GmkbKt5fSz5uhQf52m1x",
    title: "Gate Arrival",
    specializations: [
      {
        nodes: [],
        collectionName: "main",
      },
    ],
    createdBy: "ouhrac",
    root: "prg28paWo3J5oJZKpwqW",
    deleted: false,
    textValue: {
      isPartOf: "",
      parts: "test test ok",
      evaluationDimension: "",
      actor: "oh please \n\ncan you imagine",
      postConditions: "\n\n\n\n\n\n\n\n",
      Objects:
        "prg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW\n\n\nprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW",
    },
    nodeType: "activity",
    generalizations: [
      {
        collectionName: "main",
        nodes: [
          {
            id: "prg28paWo3J5oJZKpwqW",
          },
        ],
      },
    ],
    unclassified: false,
    propertyOf: {},
    numberOfGeneralizations: 1,
    locked: false,
    propertyType: {
      TestProprety: "string-array",
      description: "string",
      preConditions: "string-array",
      postConditions: "string-array",
      actor: "actor",
      Objects: "object",
      context: "context",
      ok: "string-array",
      evaluationDimension: "evaluationDimension",
    },
    properties: {
      TestProprety: [],
      ok: [],
      preConditions: [],
      postConditions: [],
      Objects: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      actor: [
        {
          collectionName: "main",
          nodes: [
            {
              id: "iyy1sBre1lXSqnKPJD8a",
            },
          ],
        },
      ],
      parts: [
        {
          collectionName: "main",
          nodes: [
            {
              id: "OSXrHQdfKmEZVUr0oR22",
            },
          ],
        },
      ],
      context: [
        {
          nodes: [
            {
              id: "MlUNhqiQfloPduiiKvyU",
            },
          ],
          collectionName: "main",
        },
      ],
      description: "The aircraft's arrival at the designated gate.",
      evaluationDimension: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      isPartOf: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
    },
    inheritance: {
      ok: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
      Objects: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
      preConditions: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      actor: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
      evaluationDimension: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
      parts: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      description: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      context: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
      postConditions: {
        ref: "prg28paWo3J5oJZKpwqW",
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      TestProprety: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: "prg28paWo3J5oJZKpwqW",
      },
    },
  },
  "Manage Aircraft": {
    nodeType: "activity",
    deleted: false,
    createdBy: "thomasmalone",
    root: "prg28paWo3J5oJZKpwqW",
    id: "prg28paWo3J5oJZKpwqW",
    generalizations: [
      {
        nodes: [
          {
            id: "ntmokzoFkA3k1iP4mLwU",
          },
        ],
        collectionName: "main",
      },
    ],
    locked: false,
    textValue: {
      actor: "oh please \n\ncan you imagine",
      Objects:
        "prg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW\n\n\nprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqWprg28paWo3J5oJZKpwqW",
      isPartOf: "",
      parts: "test test ok",
      postConditions: "\n\n\n\n\n\n\n\n",
      evaluationDimension: "",
    },
    specializations: [
      {
        nodes: [
          {
            id: "YC2Ui3sV6RCggOnUdRy3",
          },
        ],
        collectionName: "Arrival Procedures",
      },
      {
        nodes: [
          {
            id: "y3vtdh7IFcuv843xCJGg",
          },
          {
            id: "GmkbKt5fSz5uhQf52m1x",
          },
        ],
        collectionName: "main",
      },
    ],
    title: "Manage Aircraft",
    propertyType: {
      actor: "actor",
      postConditions: "string-array",
      preConditions: "string-array",
      evaluationDimension: "evaluationDimension",
      Objects: "object",
      description: "string",
      ok: "string-array",
      context: "context",
      TestProprety: "string-array",
    },
    inheritance: {
      preConditions: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      postConditions: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      evaluationDimension: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      parts: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      Objects: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      ok: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      actor: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      description: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      context: {
        ref: null,
        inheritanceType: "inheritUnlessAlreadyOverRidden",
      },
      TestProprety: {
        inheritanceType: "inheritUnlessAlreadyOverRidden",
        ref: null,
      },
    },
    properties: {
      preConditions: [],
      postConditions: [],
      actor: [
        {
          nodes: [
            {
              id: "iyy1sBre1lXSqnKPJD8a",
            },
          ],
          collectionName: "main",
        },
      ],
      isPartOf: [
        {
          nodes: [
            {
              id: "k0O6cD5duUzLSfRVoH2S",
            },
          ],
          collectionName: "main",
        },
      ],
      Objects: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      parts: [
        {
          nodes: [
            {
              id: "OSXrHQdfKmEZVUr0oR22",
            },
          ],
          collectionName: "main",
        },
      ],
      context: [
        {
          nodes: [
            {
              id: "MlUNhqiQfloPduiiKvyU",
            },
          ],
          collectionName: "main",
        },
      ],
      evaluationDimension: [
        {
          nodes: [],
          collectionName: "main",
        },
      ],
      description:
        "A comprehensive procedure overseeing all aspects of aircraft arrivals at Airport X, from initial approach to gate arrival and preparation for departure. ",
      TestProprety: ["ok"],
      ok: ["cc"],
    },
  },
};

describe("compare improvement change to the original node", () => {
  it("should give the correct result", () => {
    const improvement = {
      title: "Manage Aircraft",
      nodeType: "activity",
      change: {
        modified_property: "specializations",
        new_value: [
          {
            collectionName: "Arrival Procedures",
            collection_changes: {
              nodes_to_add: [],
              nodes_to_delete: ["New unclassifiedd"],
              final_array: [],
            },
            reasoning:
              'Removed "New unclassifiedd" as it is redundant and unclear how it specializes "Manage Aircraft".',
          },
          {
            collectionName: "main",
            collection_changes: {
              nodes_to_add: [],
              nodes_to_delete: ["Node6"],
              final_array: ["Gate Arrival"],
            },
            reasoning:
              'Removed "Node6" due to lack of clarity on its purpose.  If it represents a distinct arrival procedure, please provide more details so I can create a more descriptive entry.',
          },
        ],
        reasoning:
          "Improved organization and removed redundant/unclear specializations.",
      },
    };
    const response = compareImprovement(improvement, nodeTitles);
    expect(response.nodeId).toBe("prg28paWo3J5oJZKpwqW");
    expect(response.detailsOfChange).toEqual({
      comparison: [
        {
          collectionName: "Arrival Procedures",
          nodes: [
            {
              id: "YC2Ui3sV6RCggOnUdRy3",
              change: "removed",
            },
          ],
        },
        {
          collectionName: "main",
          nodes: [
            {
              id: "GmkbKt5fSz5uhQf52m1x",
            },
            {
              id: "y3vtdh7IFcuv843xCJGg",
              change: "removed",
            },
          ],
        },
      ],
      addedNonExistentElements: [],
      addedCollections: [],
    });

    expect(response.modifiedProperty).toBe("specializations");
  });
});
